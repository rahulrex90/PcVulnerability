using System;
using System.Linq;
using System.Net.Mail;

namespace AppCode
{
    public class Mail
    {
        public string From { get; set; }
        public string FromName { get; set; }
        public string To { get; set; }
        public string ToName { get; set; }
        public string ToCC { get; set; }
        public string ToBcc { get; set; }
        public string Subject { get; set; }
        public string Heading { get; set; }
        public string Body { get; set; }
        public string Attachment { get; set; }
        // ----------------------------------------------------------------------------------------------

        public void SendEmail()
        {
            FromName = FromName ?? AppConfiguration.Website_Name;

            MailMessage myMessage = new MailMessage();
            myMessage.From = new MailAddress(From, FromName);

            if (To.IsNotBlank())
            {
                var toArray = To.Split(';');
                foreach (var email in toArray)
                {
                    if (email.IsNotBlank())
                        myMessage.To.Add(new MailAddress(email, ToName));
                }
            }

            if (ToCC.IsNotBlank())
            {
                if (!AppConfiguration.Website_Mode_IsLocal)
                {
                    var ccArray = ToCC.Split(';');
                    foreach (var email in ccArray)
                    {
                        if (email.IsNotBlank())
                            myMessage.CC.Add(new MailAddress(email));
                    }
                }
            }
            if (ToBcc.IsNotBlank())
            {
                if (!AppConfiguration.Website_Mode_IsLocal)
                {

                   
                    var bccArray = ToBcc.Split(';');


                    foreach (var email in bccArray)
                    {
                        if (email.IsNotBlank())
                            myMessage.Bcc.Add(new MailAddress(email));
                    }
                }
            }
            if (Attachment.IsNotBlank())
            {
                var attachmentArray = Attachment.Split(';');
                foreach (var attachment in attachmentArray)
                {
                    myMessage.Attachments.Add(new Attachment(attachment));
                }
            }
            myMessage.Subject = Subject;
            myMessage.Body = Body;
            myMessage.IsBodyHtml = true;

            SmtpClient mySmtp = new SmtpClient();
            if (AppConfiguration.Website_Mode_IsLocal)
            {
                mySmtp.Host = "localhost";
                mySmtp.Port = 25;
                mySmtp.EnableSsl = false;
            }

            try
            {
                mySmtp.Send(myMessage);
            }
            catch (SmtpFailedRecipientException ex)
            {
                myMessage.To.Clear();
            }
            finally
            {
                myMessage.Dispose();
            }
        }
    }
}