
@using PCV.DAL.ViewModels

@{
    ViewBag.Title = "Menu";
}


@{

    List<DDLUserModel> roleList = ViewBag.roles;

}

<div class="page-content-wrapper">
    <div class="page-content">
        <!-- BEGIN PAGE HEADER-->
        <div class="breadcrumbs">
            <h1>
                Assign Menu To Users
            </h1>
            <ol class="breadcrumb">
                <li>
                    <a href="/" class="active">Home</a>
                </li>

            </ol>

        </div>

        <div class="row">
            <div class="col-md-12">

                <div class="portlet light bordered user-add-form-portlet">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class="fa fa-reorder"></i> Form
                        </div>
                    </div>

                    <div class="portlet-body form">

                        @using (Html.BeginForm("AssignUserMenus", "Home", FormMethod.Post, new { @class = "", role = "form", @id = "myform" }))
                        {

                            <div class="form-body">

                                @if (!ViewData.ModelState.IsValid)
                                {

                                    <div class="alert alert-danger">
                                        <button class="close" data-close="alert"></button>
                                        @Html.ValidationSummary()
                                    </div>
                                }




                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="control-label" for="name">
                                                Users:
                                                <span class="required">*</span>
                                            </label>
                                          
                                            @Html.DropDownList("UserId", new SelectList(roleList, "UserId", "UserName"), "Select User", new { @class = "form-control required select2me", @id = "ddlRoles" })
                                            <span class="help-block">
                                                @Html.ValidationMessage("UserId", "", new { @class = "text-danger" })
                                            </span>
                                        </div>
                                    </div>

                                </div>

                                <div class="row">

                                    <div class="col-md-12">
                                        <div id="dvData" class="form-group">


                                        </div>
                                    </div>






                                </div>

                                <div class="alert  dvMessage hide">
                                    <button class="close" data-close="alert"></button>
                                    <div class="dvMessage text-center">

                                    </div>
                                </div>



                            </div>
                            <div class="form-actions">

                                <button class="button" id="btnSubmit" type="submit">Assign</button>


                            </div>
                        }


                    </div>
                </div>
            </div>
        </div>
        <!-- END PAGE CONTENT-->
    </div>
</div>







@section Scripts {
    <script type="text/javascript">




        $(function () {
            $("#ddlRoles").change(function () {

                $("#dvData").html('');
                $('.dvMessage').html('').hide();
                var roleId = $("#ddlRoles").val();

                if (roleId !== "") {
                    BindAllMenu();
                }
            });


            function BindAllMenu() {

                var userId = $("#ddlRoles").val();

                $.ajax({
                    type: "GET",
                    url: "../Home/_menuListByUserId",
                    data: { userId: userId },
                    //dataType: "json",
                    success: function (response) {
                        $("#dvData").html('');
                        $("#dvData").html(response);
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        alert('Failed to retrieve menus.');
                    }
                });


            }

        });


        $("#myform").on("submit", function (event) {
            var $this = $(this);
            var frmValues = $this.serialize();
            $.ajax({
                type: $this.attr('method'),
                url: $this.attr('action'),
                data: frmValues,
                success: function (response) {
                    if (response.success === true) {

                        
                        var messs = "<button class='close' data-close='alert'></button><div class='text-center' >" + response.message + "</div >";
                        $('.dvMessage').addClass('alert-success')
                        $('.dvMessage').removeClass('hide')
                        // var message = "<div class='alertBox successMessage'><span>Success: </span>" + response.message + "</div>";
                        $('.dvMessage').html(messs).show();

                    }
                },
            })
                .done(function () {
                    //$("#para").text("Serialized! Input String is " + frmValues);
                })
                .fail(function () {
                    // $("#para").text("An error occured");
                });
            event.preventDefault();
        });



    </script>


}