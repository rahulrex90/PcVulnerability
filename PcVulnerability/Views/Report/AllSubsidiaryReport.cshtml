@using PCV.DAL.ViewModels

@{
    IList<RegionModel> regionList = ViewBag.regionList;

}
<!-- BEGIN CONTENT -->
<div class="page-content-wrapper">
    <div class="page-content">
        <!-- BEGIN PAGE HEADER-->
        <div class="breadcrumbs">
            <h1>
              ALL  Subsidiary Report
            </h1>
            <ol class="breadcrumb">
                <li>
                    <a href="">Home</a>
                </li>
                <li class="active">All Subsidiary Report</li>
            </ol>

        </div>
        <!-- END PAGE HEADER-->
        <!-- BEGIN PAGE CONTENT-->
        <div class="row">
            <div class="col-md-12">

                
                <div class="row">

                    <div class="col-md-12">
                        <div class="portlet light bordered">

                            <div class="portlet-body form">
                                <form role="form" class="validate-form" method="post" id="myform">
                                    <div class="form-body" style="padding:0px;">
                                        <div class="alert alert-danger display-hide">
                                            <button class="close" data-close="alert"></button>
                                            You have some form errors. Please check below.
                                        </div>



                                        <input type="hidden" id="page-no" name="page_no" value="1" />

                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="control-label">Date Range </label>
                                                    <div class="input-group date-picker input-daterange" data-date-format="dd-mm-yyyy">
                                                        <input type="text" class="form-control required" id="start_range" name="start_range">
                                                        <input type="hidden" id="hdStartRange" />
                                                        <span class="input-group-addon">
                                                            to
                                                        </span>
                                                        <input type="text" class="form-control required" data-date-format="dd-mm-yyyy" id="end_range" name="end_range">
                                                        <input type="hidden" id="hdEndRange" />
                                                    </div>
                                                </div>
                                            </div>


                                            <div class="col-md-4">
                                                <div class="form-group" id="report-sel-part-error">
                                                    <label class="control-label">Select Region:</label>

                                                    @Html.DropDownList("RegionId", new SelectList(regionList, "RegionCode", "RegionName"), "Select Region", new { @class = "form-control  select2me", @id = "ddlRegion" })
                                                </div>
                                            </div>


                                            <div class="col-md-4">
                                                <div class="form-group" id="report-sel-part-error">
                                                    <label class="control-label">&nbsp;</label>

                                                    <button class="button" type="submit" style="margin-top:24px;">Search</button>
                                                </div>
                                            </div>



                                        </div>


                                    </div>
                                </form>

                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="portlet light bordered">
                            <div class="portlet-title">
                                <div class="caption">
                                    <i class="fa fa-reorder"></i>Charts Representaion
                                </div>
                                <div class="actions">

                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="portlet-title">
                                        <div class="caption">
                                            <i class="fa fa-reorder"></i> All Site Result
                                        </div>
                                        <div class="actions">

                                        </div>
                                    </div>
                                    <div id="lineChartSiteGraph" style="border:1px solid gray;height:580px"></div>
                                </div>
                            </div>
                            <br />
                            <div class="portlet-body">
                                <!--div class="pagination-sec pull-right"></div>
                                <div style="clear:both;"></div>-->
                                <!--<div class="table-scrollable">-->

                                <div class="row" id="myContainer">

                                </div>


                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END PAGE CONTENT-->
    </div>
</div>

@section Scripts {



    <script type="text/javascript">
        //google.charts.load('current', { callback: drawOnloadCharts, 'packages': ['corechart', 'line'] }); // use on load and click

       google.charts.load('current', { packages: ['corechart', 'line'] }); // use on click only


    $('#start_range').on('changeDate', function (selected) {

        var date = $(this).datepicker('getDate');

        date.setDate(date.getDate() + 30);
        $('#end_range').datepicker('setEndDate', date);
        $('#hdStartRange').val(
            $('#start_range').datepicker('getFormattedDate')
        );


    });

    $('#end_range').on('changeDate', function (selected) {

        $('#hdEndRange').val(

            $('#end_range').datepicker('getFormattedDate')

        );


    });


        $("#myform").on("submit", function (event) {

            //for (i = 0; i <= 5; i++) {

            //    $('#myContainer').append('<div class="col-md-4" style="border:1px solid gray;height:280px" >' +""

            //        +'<div class="portlet-title" ><div class="caption"><i class="fa fa-reorder"></i> PC Sequrity Fail</div>' +""
            //        +'<div class="actions"></div></div >' +""
            //        +'<div id="linechart_pcSeqFail"></div></div >');
            //}
        if ($("#myform").valid()) {

            $('#myContainer').html("");

        var    data = { sDate: $('#hdStartRange').val(), eDate: $('#hdEndRange').val(), regionCode: $("#ddlRegion").val() };

          $.ajax({
              type: 'POST',
                dataType: 'json',
                contentType: 'application/json',
                url: '@Url.Action("SubsidiaryChart", "Report")',
                data: JSON.stringify(data),
                success: function (chartsdata) {

                    bindAllSIteGraph(chartsdata.siteData)

                        for (i = 0; i < chartsdata.data.length; i++) {

                            var divId = "linechart_graph_" + i;
                             $('#myContainer').append('<div class="col-md-4"  >' +""

                                 + '<div class="portlet-title" ><div class="caption"><i class="fa fa-reorder"></i> ' + chartsdata.data[i].SiteName+'</div>' +""
                                 + '<div class="actions"></div></div >' + ""
                                 + '<div id="' + divId + '" style="border:1px solid gray;height:280px"></div></div >');


                             BindAllSubsidiaryGraph(i, chartsdata.data[i]);
                        }

                       

                    },
                    error: function () {
                        alert("Error loading data! Please try again.");
                    }
                });
        }
        else {

           
        }


        event.preventDefault();
        });


        function bindAllSIteGraph(chartData) {

            var data = new google.visualization.DataTable();


            data.addColumn('string', 'Site');
            data.addColumn('number', 'Pass');
            data.addColumn({ type: 'number', role: 'annotation' });
            data.addColumn('number', 'Fail');
            data.addColumn({ type: 'number', role: 'annotation' });
            //data.addColumn('number', 'Total');
            //data.addColumn({ type: 'number', role: 'annotation' });


            for (var i = 0; i < chartData.Xpoint.length; i++) {
                data.addRows([[chartData.Xpoint[i], chartData.Ypass[i], chartData.Ypass[i], chartData.Yfail[i], chartData.Yfail[i]]]);
            }


            var options = {

                //"title": "main Graph",
                legend: { position: 'bottom', alignment: 'center' },
                isStacked: true,
                //chart: {
                //    title: 'Box Office Earnings in First Two Weeks of Opening',
                //    subtitle: 'in millions of dollars (USD)'
                //},
                //width: 600,
                //height: 300,
                vAxis: {
                    title: 'In Percentage(%)',
                    titleTextStyle: { color: 'blue' },
                    gridlines: {
                        color: 'transparent'
                    }

                },
                hAxis: {
                    title: 'Site Name',
                    titleTextStyle: { color: '#bf003d' }


                },
                // curveType: 'function',
                pointSize: 10,


                is3D: true,
                //series: {
                //    0: { color: '#e2431e' },
                //    1: { color: '#e7711b' },
                //    2: { color: '#f1ca3a' }

                //}
                colors: ['green', 'red', 'yellow']


            };

            //var chart = new google.charts.Line(document.getElementById('linechart_material'));

            //chart.draw(data, google.charts.Line.convertOptions(options));

            var chart = new google.visualization.ColumnChart(document.getElementById('lineChartSiteGraph'));
            chart.draw(data, options);

        }


        function BindAllSubsidiaryGraph(controlId,chartData) {

            var data = new google.visualization.DataTable();


            data.addColumn('string', 'Days');
            data.addColumn('number', 'Pass ' + chartData.PassPercent + '');
            data.addColumn({ type: 'number', role: 'annotation' });
            data.addColumn('number', 'Fail ' + chartData.FailPercent + '');
            data.addColumn({ type: 'number', role: 'annotation' });
            data.addColumn('number', 'Total');
            data.addColumn({ type: 'number', role: 'annotation' });


            for (var i = 0; i < chartData.Xpoint.length; i++) {
                data.addRows([[chartData.Xpoint[i], chartData.Ypass[i], chartData.Ypass[i], chartData.Yfail[i], chartData.Yfail[i], chartData.Total[i], chartData.Total[i]]]);
            }


            var options = {

                //"title": "main Graph",
                legend: { position: 'bottom', alignment: 'center' },

                //chart: {
                //    title: 'Box Office Earnings in First Two Weeks of Opening',
                //    subtitle: 'in millions of dollars (USD)'
                //},
                //width: 600,
                //height: 300,
                vAxis: {
                    title: 'Result (in numbers)',
                    titleTextStyle: { color: 'blue' },
                    gridlines: {
                        color: 'transparent'
                    }

                },
                hAxis: {
                    title: 'Days',
                    titleTextStyle: { color: '#bf003d' }


                },
                // curveType: 'function',
                pointSize: 10,


                is3D: true,
                //series: {
                //    0: { color: '#e2431e' },
                //    1: { color: '#e7711b' },
                //    2: { color: '#f1ca3a' }

                //}
                colors: ['lightgreen', 'red', 'yellow']


            };

            //var chart = new google.charts.Line(document.getElementById('linechart_material'));

            //chart.draw(data, google.charts.Line.convertOptions(options));

            var chart = new google.visualization.LineChart(document.getElementById('linechart_graph_'+controlId+''));
            chart.draw(data, options);

        }



    </script>
}