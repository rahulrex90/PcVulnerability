@using PCV.DAL.Extension
@using PCV.DAL.ViewModels
<style>
    #radioGroup .wrap {
        display: inline-block;
    }

    #radioGroup label {
        /*display: block;*/
        text-align: center;
        margin: 0 0.2em;
    }

    #radioGroup input[type="radio"] {
        display: block;
        margin: 0.5em auto;
    }
</style>
@{ 


    List<ddlPcToolSoftwareUserModel> userList = ViewBag.allUsers;

    List<ddlPcToolSoftwareModel> softList = ViewBag.allSoftwares;


    // ViewBag.allUsers
}
<!-- BEGIN CONTENT -->
<div class="page-content-wrapper">
    <div class="page-content">
        <!-- BEGIN PAGE HEADER-->
        <div class="breadcrumbs">
            <h1>
                PC Software Report
            </h1>
            <ol class="breadcrumb">
                <li>
                    <a href="/Report/DashReport">Home</a>
                </li>
                <li class="active">PC Software List</li>
            </ol>

        </div>
        <!-- END PAGE HEADER-->
        <!-- BEGIN PAGE CONTENT-->
        <div class="row">
            <div class="col-md-12">


                <div class="row">

                    <div class="col-md-12">
                        <div class="portlet light bordered">

                            <div class="portlet-body form">
                                <form role="form" class="validate-form" method="post" id="myform">
                                    <div class="form-body" style="padding:0px;">
                                        <div class="alert alert-danger display-hide">
                                            <button class="close" data-close="alert"></button>
                                            You have some form errors. Please check below.
                                        </div>



                                        <input type="hidden" id="page-no" name="page_no" value="1" />

                                        <div class="row ">
                                            <div class="col-md-12">

                                                <div id="radioGroup">
                                                    <div class="wrap " >

                                                        <input type="radio" name="rbtnFilter" value="userwise" />
                                                        <label for="rbtnFilterStudent">User ID Wise</label>
                                                      
                                                    </div>

                                                    <div class="wrap ">

                                                        <input type="radio" name="rbtnFilter" value="softwarewise" />
                                                        <label for="rbtnFilterAdmin">Software Wise</label>
                                                    </div>

                                                </div>

                                            </div>
                                        </div>
                                        <br />

                                        <div class="row hide" id="dvUser">
                                              <div class="col-md-4">
                                                <div class="form-group" id="report-sel-part-error">
                                                    <label class="control-label">User ID:</label>
                                                    @Html.DropDownList("UserId", new SelectList(userList, "UserName", "UserName"), "Select User", new { @class = "form-control required  select2me", @id = "ddlUser" })
                                                   
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group" id="report-sel-part-error">
                                                    <label class="control-label">Computer Name:</label>
                                                    <select name="part_no" id="ddlComputers" class="form-control select2me"
                                                            data-placeholder="Select Computer" data-error-container="#report-sel-part-error">
                                                       
                                                        </select>

</div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group" id="report-sel-part-error">
                                                    <label class="control-label">&nbsp;</label>

                                                    <button class="button" type="submit" style="margin-top:24px;">Search</button>
                                                </div>
                                            </div>

                                        </div>

                                        <div class="row hide" id="dvSoftware">
                                            <div class="col-md-4">
                                                <div class="form-group" id="report-sel-part-error">
                                                    <label class="control-label">Software:</label>
                                                    @Html.DropDownList("UserId", new SelectList(softList, "SoftwareName", "SoftwareName"), "Select Software", new { @class = "form-control required  select2me",@id="ddlSoftware" })

                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group" id="report-sel-part-error">
                                                    <label class="control-label">Vesion:</label>
                                                    <select name="part_no" id="ddlVersion" class="form-control select2me"
                                                            data-placeholder="Select version" data-error-container="#report-sel-part-error"></select>

                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group" id="report-sel-part-error">
                                                    <label class="control-label">&nbsp;</label>

                                                    <button class="button" type="submit" style="margin-top:24px;">Search</button>
                                                </div>
                                            </div>

                                        </div>

                                       
                                        <div class="alert  dvMessage hide">
                                            <button class="close" data-close="alert"></button>
                                            <div class="dvMessage text-center">

                                            </div>
                                        </div>
                                    </div>
                                </form>

                            </div>
                        </div>
                    </div>

                    <div class="col-md-12 hide" id="dvList">
                        <div class="portlet light bordered">
                            <div class="portlet-title">
                                <div class="caption">
                                    <i class="fa fa-reorder"></i>PC Software List
                                </div>
                                <div class="actions">
                                    <a class="button normals btn-circle" onclick="exportData()">
                                        <i class="fa fa-download"></i> Excel Export
                                    </a>
                                </div>
                            </div>
                            <div class="portlet-body" id="myContainer">
                                <!--div class="pagination-sec pull-right"></div>
                                <div style="clear:both;"></div>-->
                                <!--<div class="table-scrollable">-->




                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END PAGE CONTENT-->
    </div>
</div>


@section Scripts {


    <script type="text/javascript">



        $(function () {


            $('input[name=rbtnFilter]').click(function () {


                if ($(this).val() == "userwise")
                {

                    $("#dvUser").removeClass("hide")
                    $("#dvSoftware").addClass("hide")
                }
                else
                {
                    $("#dvSoftware").removeClass("hide")
                    $("#dvUser").addClass("hide")
                }

            })
            //$("#ddlResult").change(function () {

            //    if ($("#ddlResult").val() === "FAIL") {

            //        $("#dvRbtn").removeClass('hide');


            //    }
            //    else {

            //        $("#dvRbtn").addClass('hide');
            //    }
            //});
        })


        $("#myform").on("submit", function (event) {

            if ($("#myform").valid()) {
                $("#dvList").addClass("hide")

                var filterType = $('input[name=rbtnFilter]:checked').val();
                $.ajax({
                    type: "GET",
                    url: "../Report/GetPcSoftwareRpt",
                    data: { filterType: filterType, userName: $("#ddlUser").val(), compName: $("#ddlComputers").val(), software: $("#ddlSoftware").val(), version: $("#ddlVersion").val() },
                    //dataType: "json",
                    success: function (response) {
                        $("#dvList").removeClass("hide")
                        $("#myContainer").html('');
                        $("#myContainer").html(response);
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        var messs = "<button class='close' data-close='alert'></button><div class='text-center' >Data not Found</div >";
                        $('.dvMessage').addClass('alert-warning')
                        $('.dvMessage').removeClass('hide')
                        // var message = "<div class='alertBox successMessage'><span>Success: </span>" + response.message + "</div>";
                        $('.dvMessage').html(messs).show();
                    }
                });
            }
            else {


            }

            event.preventDefault();
        });

        $(function () {
            $("#ddlUser").change(function () {
                $('#ddlComputers').html("");

                if ($("#ddlUser").val()!="") {
                    //$('#loading').html('<i class="fa fa-spinner fa-spin fa-4x"></i>');
                    //$('#loading').css('position', 'fixed')
                    //    .css('left', '45%')
                    //    .css('top', '45%').show();
                    $.getJSON("../Report/GetAllComputerNameByUserID", { UserID: $("#ddlUser").val() },
                        function (result) {
                            var ddl = $('#ddlComputers');
                            ddl.empty();
                            ddl.append('<option value="" >-- Please Select --</option>');
                            $(result).each(function () {
                                ddl.append(
                                    $('<option/>',
                                        {
                                            value: this.Value
                                        }).html(this.Text)
                                );

                            });
                            if (result == 0) {
                                ddl.empty();
                            }
                            //$('#loading').html('');
                            //$('#loading').hide();
                        });
                }
            });

            $("#ddlSoftware").change(function () {
                $('#ddlVersion').html("");

                if ($("#ddlSoftware").val() != "") {
                    //$('#loading').html('<i class="fa fa-spinner fa-spin fa-4x"></i>');
                    //$('#loading').css('position', 'fixed')
                    //    .css('left', '45%')
                    //    .css('top', '45%').show();
                    $.getJSON("../Report/GetAllVersionByUSoftware", { software: $("#ddlSoftware").val() },
                        function (result) {
                            var ddl = $('#ddlVersion');
                            ddl.empty();
                            ddl.append('<option value="">-- Please Select --</option>');
                            $(result).each(function () {
                                ddl.append(
                                    $('<option/>',
                                        {
                                            value: this.Value
                                        }).html(this.Text)
                                );

                            });
                            if (result == 0) {
                                ddl.empty();
                            }
                            //$('#loading').html('');
                            //$('#loading').hide();
                        });
                }
            });
        });


          function exportData() {

              var filterType = $('input[name=rbtnFilter]:checked').val();
              //$.ajax({
              //    type: "GET",
              //    url: "../Report/GetPcSoftwareRpt",
              //    data: { filterType: filterType, userName: $("#ddlUser").val(), compName: $("#ddlComputers").val(), software: $("#ddlSoftware").val(), version: $("#ddlVersion").val() },
              //      //dataType: "json",

              var url = '@Url.Action("ExportExcelSoftwareRpt", "Report")' + "?filterType=" + filterType + "&userName=" + $("#ddlUser").val() + "&compName=" + $("#ddlComputers").val() + "&software=" + $("#ddlSoftware").val() + "&version=" + $("#ddlVersion").val();


            location.href = url;


        }
    </script>
}