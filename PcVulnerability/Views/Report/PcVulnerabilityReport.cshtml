@using PCV.DAL.ViewModels

<style>
    #radioGroup .wrap {
        display: inline-block;
    }

    #radioGroup label {
        /*display: block;*/
        text-align: center;
        margin: 0 0.2em;
    }

    #radioGroup input[type="radio"] {
        display: block;
        margin: 0.5em auto;
    }
</style>
@{

    IList<ddlPcToolDepartmentModel> departmentList = ViewBag.department;
    IList<ddlPcToolUserModel> userList = ViewBag.users;
}
<!-- BEGIN CONTENT -->
<div class="page-content-wrapper">
    <div class="page-content">
        <!-- BEGIN PAGE HEADER-->
        <div class="breadcrumbs">
            <h1>
                PC Vulnerability Report
            </h1>
            <ol class="breadcrumb">
                <li>
                    <a href="">Home</a>
                </li>
                <li class="active">PC Vulnerability List</li>
            </ol>

        </div>
        <!-- END PAGE HEADER-->
        <!-- BEGIN PAGE CONTENT-->
        <div class="row">
            <div class="col-md-12">


                <div class="row">

                    <div class="col-md-12">
                        <div class="portlet light bordered">

                            <div class="portlet-body form">
                                <form role="form" class="validate-form" method="post" id="myform">
                                    <div class="form-body" style="padding:0px;">
                                        <div class="alert alert-danger display-hide">
                                            <button class="close" data-close="alert"></button>
                                            You have some form errors. Please check below.
                                        </div>



                                        <input type="hidden" id="page-no" name="page_no" value="1" />

                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="control-label">Date Range </label>
                                                    <div class="input-group date-picker input-daterange" data-date-format="dd-mm-yyyy">
                                                        <input type="text" class="form-control required" id="start_range" name="start_range">
                                                        <input type="hidden" id="hdStartRange" />
                                                        <span class="input-group-addon">
                                                            to
                                                        </span>
                                                        <input type="text" class="form-control required" data-date-format="dd-mm-yyyy" id="end_range" name="end_range">
                                                        <input type="hidden" id="hdEndRange" />
                                                    </div>
                                                </div>
                                            </div>


                                            <div class="col-md-2">
                                                <div class="form-group" id="report-sel-part-error">
                                                    <label class="control-label">Select Result:</label>
                                                    <select name="part_no" id="ddlResult" class="form-control select2me"
                                                            data-placeholder="Select" data-error-container="#report-sel-part-error">
                                                        <option></option>
                                                        <option value="PASS">
                                                            Pass
                                                        </option>
                                                        <option value="FAIL">
                                                            Fail
                                                        </option>
                                                        <option value="ALL">All</option>
                                                    </select>

                                                </div>
                                            </div>

                                            <div class="col-md-2">
                                                <div class="form-group" id="report-sel-part-error">
                                                    <label class="control-label"> Department:</label>
                                                    @Html.DropDownList("DepartmentId", new SelectList(departmentList, "DepartmentName", "DepartmentName"), "Select Department", new { @class = "form-control  select2me", @id = "ddlDepartment" })

                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group" id="report-sel-part-error">
                                                    <label class="control-label"> User:</label>
                                                    @Html.DropDownList("UserID", new SelectList(userList, "UserName", "UserName"), "Select User", new { @class = "form-control   select2me", @id = "ddlUser" })

                                                </div>
                                            </div>
                                        </div>


                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group" id="report-sel-part-error">
                                                    <label class="control-label">&nbsp;</label>

                                                    <button class="button" type="submit" style="margin-top:24px;">Search</button>
                                                </div>
                                            </div>

                                          
                                        </div>





                                        <div class="row hide" id="dvRbtn">
                                            <div class="col-md-12">

                                                <div id="radioGroup">
                                                    <div class="wrap">

                                                        <input type="radio" name="rbtnFilter" value="pcplus" />
                                                        <label for="rbtnFilterStudent">PC Plus</label>
                                                    </div>

                                                    <div class="wrap">

                                                        <input type="radio" name="rbtnFilter" value="sharedfolder" />
                                                        <label for="rbtnFilterAdmin">Shared Folder</label>
                                                    </div>
                                                    <div class="wrap">

                                                        <input type="radio" name="rbtnFilter" value="antivirus" />
                                                        <label for="rbtnFilterService">Antivirus</label>
                                                    </div>
                                                    <div class="wrap">

                                                        <input type="radio" name="rbtnFilter" value="privacy" />
                                                        <label>Privacy-I</label>
                                                    </div>
                                                    <div class="wrap">

                                                        <input type="radio" name="rbtnFilter" value="screensaver" />
                                                        <label>Screen Saver</label>
                                                    </div>
                                                    <div class="wrap">

                                                        <input type="radio" name="rbtnFilter" value="printagent" />
                                                        <label>Print Agent</label>
                                                    </div>
                                                    <div class="wrap">

                                                        <input type="radio" name="rbtnFilter" value="edoc" />
                                                        <label>Edoc</label>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="hide col-lg-12 text-center " id="dvLoading">
                                                <img src="~/Content/Images/loading.gif" alt="Loading......" class="loading" />
                                            </div>
                                        </div>
                                        <div class="alert  dvMessage hide">
                                            <button class="close" data-close="alert"></button>
                                            <div class="dvMessage text-center">

                                            </div>
                                        </div>


                                    </div>
                                </form>

                            </div>
                        </div>
                    </div>

                    <div class="col-md-12 hide" id="dvList">
                        <div class="portlet light bordered">
                            <div class="portlet-title">
                                <div class="caption">
                                    <i class="fa fa-reorder"></i>PC Vulnerability List
                                </div>
                                <div class="actions">
                                    <a class="button normals btn-circle" onclick="exportData()">
                                        <i class="fa fa-download"></i> Excel Export
                                    </a>
                                </div>
                            </div>
                            <div class="portlet-body" id="myContainer">
                                <!--div class="pagination-sec pull-right"></div>
                                <div style="clear:both;"></div>-->
                                <!--<div class="table-scrollable">-->




                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END PAGE CONTENT-->
    </div>
</div>


@section Scripts {


    <script type="text/javascript">

        $('#start_range').on('changeDate', function (selected) {

            var date = $(this).datepicker('getDate');

            date.setDate(date.getDate() + 30);
            $('#end_range').datepicker('setEndDate', date);
            $('#hdStartRange').val(
                $('#start_range').datepicker('getFormattedDate')
            );


        });

        $('#end_range').on('changeDate', function (selected) {

            $('#hdEndRange').val(

                $('#end_range').datepicker('getFormattedDate')

            );


        });

        $(function () {
            $("#ddlResult").change(function () {

                if ($("#ddlResult").val() === "FAIL") {

                    $("#dvRbtn").removeClass('hide');


                }
                else {

                    $("#dvRbtn").addClass('hide');
                }
            });
        })


        $("#myform").on("submit", function (event) {

            if ($("#myform").valid()) {

                $("#dvList").addClass("hide")
                $("#dvLoading").removeClass("hide")

                var result = $("#ddlResult").val();

                if (result == "ALL" || result == "")
                {
                    result = "";

                }
                var filterType = $('input[name=rbtnFilter]:checked').val();
                $.ajax({
                    type: "GET",
                    url: "../Report/GetVulnerabilityRpt",
                    data: { sDate: $('#hdStartRange').val(), eDate: $('#hdEndRange').val(), result: result, filterType: filterType, department: $("#ddlDepartment").val(), user: $("#ddlUser").val() },
                    //dataType: "json",
                    success: function (response) {


                        $("#dvLoading").addClass("hide");
                        $("#dvList").removeClass("hide")
                        $("#myContainer").html('');
                        $("#myContainer").html(response);
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        var messs = "<button class='close' data-close='alert'></button><div class='text-center' >Data not Found</div >";
                        $('.dvMessage').addClass('alert-warning')
                        $('.dvMessage').removeClass('hide')
                        // var message = "<div class='alertBox successMessage'><span>Success: </span>" + response.message + "</div>";
                        $('.dvMessage').html(messs).show();
                    }
                });
            }
            else {


            }

            event.preventDefault();
        });


        function exportData() {

            var result = $("#ddlResult").val();

            if (result == "ALL" || result == "") {
                result = "";

            }
            var filterType = $('input[name=rbtnFilter]:checked').val();

            var url = '@Url.Action("ExportExcelVulnerabilityRpt", "Report")' + "?sDate=" + $('#hdStartRange').val() + "&eDate=" + $('#hdEndRange').val() + "&result=" + result + "&filterType=" + filterType + "&department=" + $("#ddlDepartment").val() + "&user=" + $("#ddlUser").val();


            location.href = url;


            //$.ajax({
            //    type: "GET",
            //    url: "../Report/ExportExcelVulnerabilityRpt",
            //    data: { sDate: $('#hdStartRange').val(), eDate: $('#hdEndRange').val(), result: result, filterType: filterType, department: $("#ddlDepartment").val(), user: $("#ddlUser").val() },
            //    //dataType: "json",
            //    success: function (response) {

            //    },
            //    error: function (xhr, ajaxOptions, thrownError) {

            //    }
            //});

        }
    </script>
}